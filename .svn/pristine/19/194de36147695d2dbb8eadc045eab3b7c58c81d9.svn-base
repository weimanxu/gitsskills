$(function(){
	var list=$('[class^="change"]');								 //获取修改列表
	$('[class^="change"]').each(function(){
		if($(this).attr('data-info')==''){							 //如果没有初始信息	
			$(this).removeClass('change_suc').addClass('change_wro');//将修改标签更换警告主题
			var src=$(this).parent().children(1).children(1).attr('src').replace(/suc/g,'wro');			
			$(this).parent().children(1).children(1).attr('src',src);//将图标更换成功主题
		}
	})
	
	$('[class^="change"]').click(function(){
		//更改密码页面
		var changeCodePage=`<form class="form-horizontal">
							    <div class="form-group">
								<div class="col-sm-12">
							    	<input type="password" class="form-control" id="oldCode" placeholder="旧密码">
							    </div>
							 </div>
							 <div class="form-group">
							 	<div class="col-sm-12">
							 		<input type="password" class="form-control" id="newCode" placeholder="新密码">
							 	</div>
							 </div>
							 <div class="form-group">
							 	<div class="col-sm-12">
							 		<input type="password" class="form-control" id="sureCode" placeholder="确认新密码">
							 	</div>
							 </div>
							 <div class="form-group">
							 	<div class="col-sm-12">
							 		<input type="button" class="form-control text-center submit"  id="changeCodeSubmit" value="完成">
							 	</div>
							 </div>
							</form>`;
		//更改手机号页面
		var phonePage=`<form class="form-horizontal">
					        <div class="form-group">
					        	<div class="col-sm-12">
					            	<input type="text" disabled class="form-control" id="phone" >
					            </div>
					         </div>
					         <div class="form-group">
					         	<div class="col-sm-12">
					         		<input type="text" class="form-control" id="Verification-Code" placeholder="验证码">
					         		<input type="button"  class="form-control text-center getCode"  id="message" value="获取验证码">               
					         	</div>
					         </div>
					         <div class="form-group">
					         	<div class="col-sm-12">
					         		<input type="text" class="form-control" id="newPhone" placeholder="新手机号码">
					         	</div>
					         </div>
					         <div class="form-group">
					         	<div class="col-sm-12">
					         		<input type="text" class="form-control" id="newVerification-Code" placeholder="验证码">
					         		<input type="button" class="form-control text-center getCode" id="newmessage" value="获取验证码">
					         	</div>
					         </div>
					         <div class="form-group">
					         	<div class="col-sm-12">
					         		<input type="button" class="form-control text-center submit"  id="newPhoneSubmit" value="完成">
					         	</div>
					         </div>
					     </form>`;
			//绑定手机页面 
			var newPhonePage=`<form class="form-horizontal">
						        <div class="form-group">
						        	<div class="col-sm-12">
						            	<input type="text" class="form-control" id="newPhone" placeholder="手机号码">
						            </div>
						        </div>
						        <div class="form-group">
						        	<div class="col-sm-12">
						            	<input type="text" class="form-control" id="Verification-Code" placeholder="验证码">
						            	<input type="button" class="form-control text-center getCode"  id="newmessage" value="获取验证码"> 
						            </div>
						        </div>
						        <div class="form-group">
						        	<div class="col-sm-12">
						            	<input type="button" class="form-control text-center submit" id="phoneSubmit" value="完成">
						            </div>
						        </div>
						     </form>`;
			//更改邮箱页面
			var emailPage=`<form class="form-horizontal">
						        <div class="form-group">
						        	<div class="col-sm-12">
						        		<input type="email" disabled class="form-control" id="email-code"  value=email>
						        	</div>
						        </div>
						        <div class="form-group">
						        	<div class="col-sm-12">
						            	<input type="text" class="form-control" id="Verification-Code" placeholder="验证码">
						            	<input type="button" class="form-control text-center getCode"  id="email_message" value="获取邮箱验证码"> 
						            </div>
						        </div>
							    <div class="form-group">
							        <div class="col-sm-12">
							            <input type="email" class="form-control" id="newEmail" placeholder="新邮箱地址">
							        </div>
							    </div>
							    <div class="form-group">
							        <div class="col-sm-12">
							            <input type="text" class="form-control" id="newVerification-Code" placeholder="验证码">
							            <input type="button" class="form-control text-center getCode"  id="new_email_message" value="获取邮箱验证码">
							        </div>
							    </div>
							    <div class="form-group">
							        <div class="col-sm-12">
							            <input type="button" class="form-control text-center submit" id="emailSubmit" value="完成">
							        </div>
							    </div>
						   </form>`;
			//绑定资金密码页面
			var crashPage=`<form class="form-horizontal">
						        <div class="form-group">
						        	<div class="col-sm-12">
						        		<input type="password" class="form-control" id="crash-code" placeholder="资金密码">
						        	</div>
						        </div>
						        <div class="form-group">
						        	<div class="col-sm-12">
						        		<input type="password" class="form-control" id="code-sure" placeholder="确认资金密码">
						        	</div>
						        </div>
						        <div class="form-group">
						        	<div class="col-sm-12">
						        		<input type="text" disabled class="form-control" id="phone" placeholder="手机号码">
						        	</div>
						        </div>
						        <div class="form-group">
						        	<div class="col-sm-12">
						        		<input type="text" class="form-control" id="Verification-Code" placeholder="验证码">
						        		<input type="button" class="form-control text-center getCode" id="crash_message" value="获取验证码">
						        	</div>
						        </div>
						        <div class="form-group">
							        <div class="col-sm-12">
							            <input type="button" class="form-control text-center submit" id="crashSubmit" value="完成">
							        </div>
							    </div>
						   </form>`;
			var content=$(this).parent().children(':first-child').children(':last-child').html();
	        var phone=$(this).attr('data-info'); 
	        if(content=='登录密码'){
	            $('.modal-title').html('修改登录密码');
	            $('.modal-body').html(changeCodePage);  
	        }
	        else if(content=='手机号码'&& phone!==''){
	            $('.modal-title').html('修改手机号');
	            $('.modal-body').html(phonePage);
	            $('#phone').val(phone);
	        }
	        else if(content=='手机号码'&&phone==''){
	            $('.modal-title').html('绑定手机号');
	            $('.modal-body').html(newPhonePage);
	        }
	        else if(content=='资金密码'){
	            $('.modal-title').html('设置资金密码');
	            var phone=$(this).attr('data-phone');
	            var email=$(this).attr('data-email');
	            $('.modal-body').html(crashPage);
	            if(phone==''){            	
	            	$('#phone').val(email);
	            	$('#crash_message').val('获取邮箱验证码');
	            }else{
	            	$('#phone').val(phone);
	            } 
	        }
	        else if(content=='邮箱绑定'){
	            $('.modal-title').html('绑定登录邮箱');
	            var email=$(this).attr('data-info');         
	            
	            $('.modal-body').html(emailPage);
	            $('#email-code').val(email);
	        }
	    });

	$('.modal-body').on('click','#changeCodeSubmit',function(){  //确认更换密码
		var code=$('#oldCode').val();
		var newCode=$('#newCode').val();
		var sureCode=$('#sureCode').val();
		if(code==''){
			layer.tips('旧密码不能为空', $('#oldCode'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}else if(newCode==''){
			layer.tips('新密码不能为空', $('#newCode'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}else if(sureCode==''){
			layer.tips('确认密码不能为空', $('#sureCode'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}else if(sureCode!==newCode){
			layer.tips('密码不一致', $('#sureCode'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}
		commitPost('takeSetLoginPwd',{newPassword : newCode,oldPassword:code});
		
	}).on('click','#crashSubmit',function(){				//确认资金密码
		var phone=$('#phone').val();
		var crash_code=$('#crash-code').val();
		var codesure=$('#code-sure').val();
		var Verif_code=$('#Verification-Code').val();
		
		if(phone==''){
			layer.tips('手机号不能为空', $('#phone'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}else if(crash_code==''){
			layer.tips('密码不能为空', $('#crash-code'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}else if(codesure==''){
			layer.tips('确认密码不能为空', $('#code-sure'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}else if(crash_code!==codesure){
			layer.tips('密码不一致', $('#code-sure'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}else if(Verif_code==''){
			layer.tips('请输入验证码', $('#Verification-Code'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}
		commitPost('takeSetFundPwd',{fundPwd : crash_code,  verifyCode: Verif_code});
		
	}).on('click','#newPhoneSubmit',function(){					//确认更换新手机
		var code=$('#Verification-Code').val();
		var newCode=$('#newVerification-Code').val();
		var phone=$('#newPhone').val();
		if(code==''){
			layer.tips('请输入验证码', $('#Verification-Code'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}else if(phone==''){
			layer.tips('手机号码不能为空', $('#newPhone'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}else if(newCode==''){
			layer.tips('请输入验证码', $('#newVerification-Code'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}
		commitPost('takeSetPhone',{old_code:code,new_code:newCode,new_phone:phone});
		
	}).on('click','#phoneSubmit',function(){					//绑定手机
		var code=$('#Verification-Code').val();
		var phone=$('#newPhone').val();
		
		if(phone==''){
			layer.tips('手机号码不能为空', $('#phone'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}else if(code==''){
			layer.tips('请输入验证码', $('#Verification-Code'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}
		commitPost('takeSetPhone',{new_code:code,new_phone: phone});
		
	}).on('click','#emailSubmit',function(){					//确认邮箱
		var code=$('#Verification-Code').val();
		var newCode=$('#newVerification-Code').val();
		var email=$('#newEmail').val();
		if(code==''){
			layer.tips('请输入验证码', $('#Verification-Code'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}
		else if(email==''){
			layer.tips('邮箱不能为空', $('#newEmail'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}
		else if(newCode==''){
			layer.tips('请输入验证码', $('#newVerification-Code'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}
		commitPost('takeSetEmail',{old_code:code, new_code:newCode,new_email:email});
	}).on('click','#newmessage',function(){					//向新手机发送验证码
		var type="changePhone";
		var phone=$('#newPhone').val();
		if(phone==''){
			layer.tips('手机号码不能为空', $('#newPhone'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}
		messagePost('#newmessage','sendPhoneCode',{type:type,phone:phone});
	}).on('click','#message',function(){					//发送手机验证码
		messagePost('#message','sendPhoneCode',{type:"changePhoneOld"});
	}).on('click','#email_message',function(){				//向更换邮箱发送验证码
		messagePost('#email_message','sendEmailCode',{type:"changeEmailOld"});
	}).on('click','#new_email_message',function(){			//向绑定邮箱发送验证码
		var type="changeEmail";
		var email=$('#newEmail').val();
		if(email==''){
			layer.tips('邮箱不能为空', $('#newEmail'), {
	            tips: [1, '#d9534f']
	        });	
			return false;
		}
		messagePost('#new_email_message','sendEmailCode',{type:type,email:email});
	}).on('click','#crash_message',function(){
		var phone=$('#crash').attr('data-phone');
	    var email=$('#crash').attr('data-email');
		var type="setFundPwd";
		if(phone==''){
			var url="sendEmailCode";
		}else{
			var url="sendPhoneCode";
		}
		messagePost('#crash_message',url,{type:type});
	})
	function messagePost(id,url,type){
		$(id).attr("disabled",true); 
		$.post(url,type, function(res) {
	        if (res.success) {  	
	        	$(id).css('background-color','#e5e5e5');
	        	var time=60;
	        	var timer=setInterval(function(){
	        		time-=1;
	        		$(id).val(time+'s后重新发送');	
	        	},1000); 
	        	setTimeout(function(){	
	        		clearInterval(timer);
	        		$(id).val('获取验证码');	
	        		$(id).css('background-color','#fff');
	        		time=60;
	        		$(id).removeAttr("disabled"); 
	            },60000);
	        }else {
	        	$(id).removeAttr("disabled"); 
	        	$(id).css('background-color','#fff');
	            layer.tips(res.error, $(id), {
	                tips: [1, '#d9534f']
	            });
	        }
	    }, 'json');
	}
	function commitPost(url,type){
		$.post(url, type, function(res) {
	        if (res.success) {
	        	$('#myModal').modal('hide');
	            layer.msg(res.data, {
	                icon: 1,
	                time: 2000
	            }, function() {
	                window.location.reload();
	            });
	        } else {
	            layer.tips(res.error, $('.submit'), {
	                tips: [1, '#d9534f']
	            });
	        }
	    }, 'json');
	}
})




